[{"path":"/articles/Introduction.html","id":"introducing-the-mvtweedie-distribution-for-regression-based-analysis-of-stomach-contents","dir":"Articles","previous_headings":"","what":"Introducing the mvtweedie distribution for regression-based analysis of stomach contents","title":"Introduction to mvtweedie","text":"mvtweedie n R package interpret Tweedie generalized linear model (GLM) generalized additive model (GAM) involving multiple classes estimate proportions class, implicitly involving multivariate-logit transformation parameters predictions. approach generalizes Poisson--multinomial transformation allow non-integer responses, can analyze either pre-processed (transformed proportions) raw (zero-inflated positive real values) data. approach helpful, e.g., analyzing diet samples heavily zero inflated without pre-processing samples prior analysis. cases, Tweedie distribution can interpreted mechanistically thinned double-marked Poisson point process representing foraging processes.","code":""},{"path":"/articles/Introduction.html","id":"ecological-motivation","dir":"Articles","previous_headings":"Introducing the mvtweedie distribution for regression-based analysis of stomach contents","what":"Ecological motivation","title":"Introduction to mvtweedie","text":"propose thinking diet samples arising thinnned double-marked point process, marks representing prey category size. visualize , simulate square spatial domain three prey species, different utilization distribution. simulate location size individual prey species. also imagine predator might sampled three different locations, recently moved area varied size (shown shaded circles).  data-generating process, can conduct multiple simulations calculate true distribution prey proportions occurred within foraging area predator sites , B, C. sometimes zero given prey (occurs prey individual within foraging patch), otherwise continuous-valued positive response (arising sum prey size prey individuals area). first plot distribution proportion prey site.  Finally, can approximate true distribution prey proportions using generalized linear model log-linked Tweedie distribution, converting predictions proportion. call multivariate Tweedie distribution. However, closed-form expression moment-generating function, instead interpreted “multivariate Tweedie generalized estimating equation”.  therefore propose use log-linked Tweedie GLM fit diet samples predict prey proportions.","code":"#> Loading required package: sp"},{"path":"/articles/Introduction.html","id":"example-application-for-tuften-puffins-on-middleton-island","dir":"Articles","previous_headings":"","what":"Example application for tuften puffins on Middleton Island","title":"Introduction to mvtweedie","text":"apply method, first format data long-form data frame, includes row combination prey sample, columns prey group sample ID, measured quantity diet sample prey, predictor /offset variables. fit log-linked regression model prey samples, multiple responses sample. case, use mgcv fit Generalized Additive Model (GAM) specifically include: smoothing term s(Year) shared among prey groups, representing variation time expected prey biomass stomach; smoothing term s(Year,=group) differs among prey groups, representing prey switching time; group-specific intercept 0 + group represents expected differences prey proportion time first term essentially “detectability” covariate, representing changes attack capture rates time. replaced fixed random effect sample, although model slow using mgcv. equal effect predicted measurements prey category (due us using log-linked model), therefore “drops ” predicting prey proportions. Alternatively, pre-process data sample constant mean prey density. (rougly) similar marginalizing across unmodeled variation total prey measurement sample. fitted GAM gam0 include covariance response prey species (conditional upon estimated response terms included formula). However, predict(mygam) now predict response proportions across modeled categories, include negative covariance among categories.","code":"# Loading package library(mvtweedie)  # load data set data( Middleton_Island_TUPU, package=\"mvtweedie\" ) Middleton_Island_TUPU$Year = as.numeric(as.character( Middleton_Island_TUPU$Year_factor ))  # Illustrate format knitr::kable( head(Middleton_Island_TUPU), digits=1, row.names=FALSE) # Run Tweedie GLM library(mgcv) gam0 = gam( formula = Response ~ 0 + group + s(Year,by=group) + s(Year),                   data = Middleton_Island_TUPU,                   family = tw )  # Load class to enable predict.mvtweedie mygam = gam0 class(mygam) = c( \"mvtweedie\", class(mygam) )"},{"path":"/articles/Introduction.html","id":"visualizing-covariate-responses","dir":"Articles","previous_headings":"Example application for tuften puffins on Middleton Island","what":"Visualizing covariate responses","title":"Introduction to mvtweedie","text":"fitting model, can visualize predicted proportion prey function covariates. simple example, can manually construct predictive grid covariate Year, calculate predictions, plot using ggplot.  complicated models, however, might cumbersome construct full grid across covariates. can instead automate process using third-party packages. , show use pdp calculate partial dependence plot:   simple example, partial dependence plot predictive grid result visualization effects. However, guarunteed case models covariates.","code":"# Predict values newdata = expand.grid( \"group\" = levels(Middleton_Island_TUPU$group),                        \"Year\" = 1978:2018 ) pred = predict( mygam,                 se.fit = TRUE,                 origdata = Middleton_Island_TUPU,                 newdata = newdata ) newdata = cbind( newdata, fit=pred$fit, se.fit=pred$se.fit ) newdata$lower = newdata$fit - newdata$se.fit newdata$upper = newdata$fit + newdata$se.fit  # Plot library(ggplot2) theme_set(theme_bw()) ggplot(newdata, aes(Year, fit)) +   geom_pointrange(aes(ymin = lower, ymax = upper)) +   facet_wrap(vars(group)) +   scale_color_viridis_c(name = \"SST\") +   ylim(0,1) +   labs(y=\"Predicted proportion\") library(pdp)  # Make function to interface with pdp pred.fun = function( object, newdata ){   predict( object = object,            origdata = object$model,            category_name = \"group\",            newdata = newdata ) }  # Calculate partial dependence # approx = TRUE gives effects for average of other covariates # approx = FALSE gives each pdp curve Partial = partial( object = mygam,                    pred.var = c( \"Year\", \"group\"),                    pred.fun = pred.fun,                    train = mygam$model,                    approx = TRUE )  # Lattice plots as default option library( lattice ) plotPartial( Partial ) # using in ggplot2 ggplot(data=Partial, aes(x=Year, y=yhat)) + # , group=yhat.id   geom_line( ) +   facet_grid( vars(group) ) +   labs(y=\"Predicted proportion\")"},{"path":"/articles/Introduction.html","id":"spatial-analysis-of-wolf-prey","dir":"Articles","previous_headings":"","what":"Spatial analysis of Wolf prey","title":"Introduction to mvtweedie","text":"next demonstrate multivariate Tweedie can used spatial analysis predict diet proportions. use samples environmental DNA wolf scats collected southeast Alaska. reduce analysis four selected prey species speed model fitting. fit generalized additive model tensor-spline interaction Latitude Longitude. Finally, define function computes predictions grid formed different values predictor: use function visualize prey proportions across landscape southeast Alaska inhabited wolves:","code":"# Load data data(southeast_alaska_wolf) groups = c(\"Black tailed deer\",\"Marine mammal\", \"Mountain goat\", \"Beaver\") southeast_alaska_wolf = subset( southeast_alaska_wolf,                                 group %in% groups )  #  southeast_alaska_wolf$group = factor(southeast_alaska_wolf$group)  # Illustrate format knitr::kable( head(southeast_alaska_wolf), digits=1, row.names=FALSE) # Using mgcv gam_wolf = gam( formula = Response ~ 0 + group + s(Latitude,Longitude,m=c(1,0.5),bs=\"ds\") +      s(Latitude,Longitude,by=group,m=c(1,0.5),bs=\"ds\"),   data = southeast_alaska_wolf,   family = tw ) class(gam_wolf) = c( \"mvtweedie\", class(gam_wolf) ) predict_grid <- function( model,           exclude_terms = NULL,           length_out = 50,           values = NULL,           ... ){    if( !any(c(\"gam\",\"glmmTMB\") %in% class(model)) ){     stop(\"`predict_grid` only implemented for mgcv and glmmTMB\")   }   n_terms <- length(model[[\"var.summary\"]])   term_list <- list()   for (term in 1:n_terms) {     term_summary <- model[[\"var.summary\"]][[term]]     term_name <- names(model[[\"var.summary\"]])[term]     if (term_name %in% names(values)) {       new_term <- values[[which(names(values) == term_name)]]       if (is.null(new_term)) {         new_term <- model[[\"var.summary\"]][[term]][[1]]       }     }     else {       if (is.numeric(term_summary)) {         min_value <- min(term_summary)         max_value <- max(term_summary)         new_term <- seq(min_value, max_value, length.out = length_out)       }       else if (is.factor(term_summary)) {         new_term <- levels(term_summary)       }       else {         stop(\"The terms are not numeric or factor.\\n\")       }     }     term_list <- append(term_list, list(new_term))     names(term_list)[term] <- term_name   }   new_data <- expand.grid(term_list)   class(model) = c( \"mvtweedie\", class(model) )   pred <- predict( model,                    newdata = new_data,                    se.fit = TRUE,                    #original_class = c(\"gam\",\"glm\",\"lm\"),                    ...)   predicted <- as.data.frame(pred)   predictions <- cbind(new_data, predicted)   return(predictions) } library(rnaturalearth) library(raster) library(sf) library(dplyr) # Predict raster on map pred_wolf = predict_grid( gam_wolf,                  origdata = southeast_alaska_wolf,                  length_out = 100 ) pred_wolf$cv.fit = pred_wolf$se.fit / pred_wolf$fit  # Map oceanmap layer US_high = ne_countries(scale=10, country=\"united states of america\") st_box = st_polygon( list(cbind( x=c(-140,-125,-124,-140,-140),                                   y=c(50,50,60,60,50))) ) st_box = st_sfc(st_box, crs=st_crs(US_high) ) wmap = st_intersection( US_high, st_box ) oceanmap = st_difference( st_as_sfc(st_bbox(wmap)), wmap )  sf.isl <- data.frame(island = c(\"Baranof\", \"Chichagof\", \"Admiralty\"),                       lat = c(57.20583, 57.88784, 57.59644),                       lon = c(-135.1866, -136.0024, -134.5776)) %>%   st_as_sf(., coords = c(\"lon\", \"lat\"), crs = 4326)   mask.land = ne_countries(scale=10, country=\"united states of america\", returnclass = 'sf') %>%   st_set_crs(., 4326) %>%   st_cast(., \"POLYGON\") %>%   st_join(., sf.isl) %>%    filter(!is.na(island))  # Make figure my_breaks = c(0.02,0.1,0.25,0.5,0.75) ggplot(oceanmap) +   geom_tile(data=pred_wolf, aes(x=Longitude,y=Latitude,fill=fit)) +   geom_sf() +   geom_sf(data = mask.land, inherit.aes = FALSE, fill = \"darkgrey\") +    coord_sf(xlim=range(pred_wolf$Longitude), ylim=range(pred_wolf$Latitude), expand = FALSE) +   facet_wrap(vars(group), ncol = 5) +   scale_fill_gradient2(name = \"Proportion\", trans = \"sqrt\", breaks = my_breaks) +   scale_y_continuous(breaks = seq(55,59,2)) +   scale_x_continuous(breaks = c(-135, -133.5, -132)) +   theme(axis.text = element_text(size = 7))"},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"James Thorson. Author, maintainer.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Thorson, J. T., Arimitsu, M. L., Levi, T., & Roffler, G. H. (2022). Diet analysis using generalized linear models derived foraging processes using R package mvtweedie. Ecology, 103(5), e3637. https://doi.org/10.1002/ecy.3637","code":"@Article{,   title = {Diet analysis using generalized linear models derived from foraging processes using R package mvtweedie},   journal = {Ecology},   volume = {103},   number = {5},   pages = {e3637},   year = {2022},   doi = {doi.org/10.1002/ecy.3637},   url = {https://doi.org/10.1002/ecy.3637},   author = {J. T. Thorson and Mayumi L. Arimitsu and Taal Levi and Gretchen Roffler}, }"},{"path":"/index.html","id":"mvtweedie","dir":"","previous_headings":"","what":"Fit multivariate logit Tweedie model using mgcv or glmmTMB","title":"Fit multivariate logit Tweedie model using mgcv or glmmTMB","text":"R package interpret Tweedie generalized linear model (GLM) generalized additive model (GAM) involving multiple classes estimate proportions class, implicitly involving multivariate-logit transformation parameters predictions. approach generalizes Poisson--multinomial transformation allow non-integer responses, can analyze either pre-processed (transformed proportions) raw (zero-inflated positive real values) data. approach helpful, e.g., analyzing diet samples heavily zero inflated without pre-processing samples prior analysis. cases, Tweedie distribution can interpreted mechanistically thinned double-marked Poisson point process representing foraging processes.","code":""},{"path":"/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Fit multivariate logit Tweedie model using mgcv or glmmTMB","text":"Thorson, J. T., Arimitsu, M. L., Levi, T., & Roffler, G. (2022). Diet analysis using generalized linear models derived foraging processes using R package mvtweedie. Ecology. 103(5): e3637.","code":""},{"path":"/reference/Middleton_Island_TUPU.html","id":null,"dir":"Reference","previous_headings":"","what":"Middleton Island tufted puffin diets — Middleton_Island_TUPU","title":"Middleton Island tufted puffin diets — Middleton_Island_TUPU","text":"Data demonstrate multivariate Tweedie GAM time-series","code":""},{"path":"/reference/Middleton_Island_TUPU.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Middleton Island tufted puffin diets — Middleton_Island_TUPU","text":"","code":"data(Middleton_Island_TUPU)"},{"path":"/reference/Middleton_Island_TUPU.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Middleton Island tufted puffin diets — Middleton_Island_TUPU","text":"data long-form data frame","code":""},{"path":"/reference/Middleton_Island_TUPU.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Middleton Island tufted puffin diets — Middleton_Island_TUPU","text":"Data sufficient demonstrate use Tweedie Generalized Additive Model provide inference proportions e.g. food habits analysis, model output processed represent multivariate logit Tweedie model. Specifically includes Tufted Puffin (Fratercula cirrhata) bill loads sampled Middleton Island. Response Numeric prey biomass bill load samples Year Numeric year group factor representing prey species category SampleID factor level every sampling occasion, e.g., use row normalization","code":""},{"path":"/reference/Middleton_Island_TUPU.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Middleton Island tufted puffin diets — Middleton_Island_TUPU","text":"Hatch, S., G. Sanger. 1992. Puffins Samplers Juvenile Pollock Forage Fish Gulf Alaska. Marine Ecology Progress Series 80: 1-14.","code":""},{"path":"/reference/Middleton_Island_TUPU.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Middleton Island tufted puffin diets — Middleton_Island_TUPU","text":"Mayumi Arimitsu","code":""},{"path":"/reference/mvtweedie.html","id":null,"dir":"Reference","previous_headings":"","what":"Multivariate Tweedie distribution for predicting diet proportions — mvtweedie","title":"Multivariate Tweedie distribution for predicting diet proportions — mvtweedie","text":"Using regression methods analyze diet proportions marked point process","code":""},{"path":"/reference/mvtweedie.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Multivariate Tweedie distribution for predicting diet proportions — mvtweedie","text":"Diet samples often measure count biomass different prey categories. Rather converting data proportion fitting proportions data, can instead represent diet samples outcome thinnned double-marked point process, marks include prey category size per encounter, thinning represents variation attack capture rates conceptually similar detectability/catchability point-count sampling analyses. Analyzing raw prey measurements (rather proportions) allows wide range models (associated --shelf software), predictions can still converted proportions (associated standard errors) model fitted, can represent covariance prey measurements within sample using covariates explain sample-specific attack/capture rates.","code":"If the prey densities follow a        a Poisson point-process, and prey size per encounter follows a gamma        distribution, then the resulting distribution for biomass of each prey       follows a multivariate Tweedie distribution. We therefore interpret       the multivariate Tweedie distribution as a \"process-based\" model       for prey samples."},{"path":"/reference/mvtweedie.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Multivariate Tweedie distribution for predicting diet proportions — mvtweedie","text":"Thorson, J. T., Arimitsu, M. L., Levi, T., & Roffler, G. H. (2022). Diet analysis using generalized linear models derived foraging processes using R package mvtweedie. Ecology, 103(5), e3637. doi:10.1002/ecy.3637","code":""},{"path":"/reference/predict.mvtweedie.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict proportions for new data — predict.mvtweedie","title":"Predict proportions for new data — predict.mvtweedie","text":"Predict proportions associated standard errors using standard S3 object interface","code":""},{"path":"/reference/predict.mvtweedie.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict proportions for new data — predict.mvtweedie","text":"","code":"# S3 method for mvtweedie predict(   object,   category_name = \"group\",   newdata,   origdata = object$model,   se.fit = FALSE,   ... )"},{"path":"/reference/predict.mvtweedie.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict proportions for new data — predict.mvtweedie","text":"object output gam glmmTMB, class(object)=c(\"mvtweedie\",...) ... indicates original values class(object) category_name name column indicates grouping variable newdata optional data frame look variables     predict.  omitted, fitted values used. origdata original data used fitting se.fit switch indicating standard errors required. ... arguments passed methods.","code":""},{"path":"/reference/predict.mvtweedie.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict proportions for new data — predict.mvtweedie","text":"predict.mvtweedie produces vector predicted proportions list containing predicted proportions standard errors.","code":""},{"path":"/reference/predict.mvtweedie.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Predict proportions for new data — predict.mvtweedie","text":"Tweedie GLM using log-link multiple categories can transformed yield predicted proportions associated SEs, model interpreted multivariate logit Tweedie distribution. function transformation model fitted using: generalized additive model (GAM) using gam generalized linear mixed model (GLMM) using glmmTMB also calculates approximation standard error proportion","code":""},{"path":"/reference/predict.mvtweedie.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Predict proportions for new data — predict.mvtweedie","text":"","code":"# Load packages library(mvtweedie)  # load data set data( Middleton_Island_TUPU, package=\"mvtweedie\" ) DF = Middleton_Island_TUPU  # Run Tweedie GLM gam0 = mgcv::gam( formula = Response ~ 0 + group, data = DF, family = tw ) #> Error in eval(expr, envir, enclos): object 'tw' not found  # Inspect results class(gam0) = c( \"mvtweedie\", class(gam0) ) #> Error in eval(expr, envir, enclos): object 'gam0' not found predict(gam0, se.fit=TRUE, origdata = DF) #> Error in eval(expr, envir, enclos): object 'gam0' not found"},{"path":"/reference/southeast_alaska_wolf.html","id":null,"dir":"Reference","previous_headings":"","what":"Wolf environmental DNA in southeast Alaska — southeast_alaska_wolf","title":"Wolf environmental DNA in southeast Alaska — southeast_alaska_wolf","text":"Data demonstrate multivariate Tweedie GAM spatial analysis","code":""},{"path":"/reference/southeast_alaska_wolf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Wolf environmental DNA in southeast Alaska — southeast_alaska_wolf","text":"","code":"data(southeast_alaska_wolf)"},{"path":"/reference/southeast_alaska_wolf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Wolf environmental DNA in southeast Alaska — southeast_alaska_wolf","text":"data long-form data frame","code":""},{"path":"/reference/southeast_alaska_wolf.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Wolf environmental DNA in southeast Alaska — southeast_alaska_wolf","text":"Data sufficient demonstrate use Tweedie GLM provide inference proportions e.g. food habits analysis, model output processed represent multivariate logit Tweedie model. Specifically includes environmental DNA sampling wolf scats obtained Southeast Alaska. Latitude Latitude scat sample Longitude Longitude scat sample group prey groupings eDNA smaples Response relative read abundance calculated mean proportion DNA sequence reads species among samples given scat","code":""},{"path":"/reference/southeast_alaska_wolf.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Wolf environmental DNA in southeast Alaska — southeast_alaska_wolf","text":"Roffler, G. H., J. M. Allen, . Massey, T. Levi. 2021. Wolf Dietary Diversity Island Archipelago. Bulletin Ecological Society America 102: 1-6. doi:10.1002/bes2.1834","code":""},{"path":"/reference/southeast_alaska_wolf.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Wolf environmental DNA in southeast Alaska — southeast_alaska_wolf","text":"Gretchen Roffler","code":""}]
